<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Fraud Detection Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .metric {
            text-align: center;
            padding: 15px;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .metric-label {
            color: #666;
            margin-top: 5px;
        }
        .alert {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .alert-high {
            background: #ffcdd2;
            border-left-color: #d32f2f;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-fraud {
            background: #ffcdd2;
            color: #d32f2f;
        }
        .status-legit {
            background: #c8e6c9;
            color: #388e3c;
        }
        .refresh-info {
            text-align: center;
            color: #666;
            margin-top: 20px;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸš¨ Real-Time Fraud Detection Dashboard</h1>
        <p>Live monitoring of transaction fraud detection system</p>
        <div id="last-update">Last Updated: <span id="timestamp">Loading...</span></div>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <div class="metric">
                <div class="metric-value" id="total-transactions">-</div>
                <div class="metric-label">Total Transactions</div>
            </div>
        </div>
        
        <div class="card">
            <div class="metric">
                <div class="metric-value" id="fraud-detected" style="color: #f44336;">-</div>
                <div class="metric-label">Fraud Detected</div>
            </div>
        </div>
        
        <div class="card">
            <div class="metric">
                <div class="metric-value" id="fraud-rate">-%</div>
                <div class="metric-label">Fraud Rate</div>
            </div>
        </div>
        
        <div class="card">
            <div class="metric">
                <div class="metric-value" id="total-amount">$-</div>
                <div class="metric-label">Total Volume</div>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h3>Fraud vs Legitimate</h3>
            <div class="chart-container">
                <canvas id="fraudChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h3>Transaction Amount Distribution</h3>
            <div class="chart-container">
                <canvas id="amountChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>ðŸš¨ Recent Fraud Alerts</h3>
        <div id="fraud-alerts">
            <p style="text-align: center; color: #666;">Loading alerts...</p>
        </div>
    </div>

    <div class="card">
        <h3>ðŸ“Š Recent Transactions</h3>
        <div id="recent-transactions">
            <p style="text-align: center; color: #666;">Loading transactions...</p>
        </div>
    </div>

    <div class="refresh-info">
        <p>ðŸ”„ Dashboard refreshes every 15 seconds</p>
        <p>Data source: Kafka â†’ Spark â†’ CSV files</p>
    </div>

    <script>
        // Initialize charts
        const fraudCtx = document.getElementById('fraudChart').getContext('2d');
        const amountCtx = document.getElementById('amountChart').getContext('2d');
        
        let fraudChart = new Chart(fraudCtx, {
            type: 'doughnut',
            data: {
                labels: ['Legitimate', 'Fraudulent'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#4caf50', '#f44336'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        let amountChart = new Chart(amountCtx, {
            type: 'bar',
            data: {
                labels: ['$0-100', '$100-500', '$500-1K', '$1K-5K', '$5K+'],
                datasets: [{
                    label: 'Legitimate',
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: '#4caf50'
                }, {
                    label: 'Fraudulent',
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: '#f44336'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Simulate data loading (in real implementation, this would fetch from API)
        function loadDashboardData() {
            // Update timestamp
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
            
            // Simulate random data for demo
            const totalTransactions = Math.floor(Math.random() * 1000) + 500;
            const fraudDetected = Math.floor(Math.random() * 50) + 10;
            const fraudRate = ((fraudDetected / totalTransactions) * 100).toFixed(1);
            const totalAmount = (Math.random() * 1000000 + 100000).toFixed(0);
            
            // Update metrics
            document.getElementById('total-transactions').textContent = totalTransactions.toLocaleString();
            document.getElementById('fraud-detected').textContent = fraudDetected.toLocaleString();
            document.getElementById('fraud-rate').textContent = fraudRate + '%';
            document.getElementById('total-amount').textContent = '$' + Number(totalAmount).toLocaleString();
            
            // Update fraud chart
            fraudChart.data.datasets[0].data = [totalTransactions - fraudDetected, fraudDetected];
            fraudChart.update();
            
            // Update amount chart with random data
            const amountData = [
                [Math.floor(Math.random() * 100), Math.floor(Math.random() * 20)],
                [Math.floor(Math.random() * 150), Math.floor(Math.random() * 30)],
                [Math.floor(Math.random() * 200), Math.floor(Math.random() * 25)],
                [Math.floor(Math.random() * 180), Math.floor(Math.random() * 15)],
                [Math.floor(Math.random() * 120), Math.floor(Math.random() * 10)]
            ];
            
            amountChart.data.datasets[0].data = amountData.map(d => d[0]);
            amountChart.data.datasets[1].data = amountData.map(d => d[1]);
            amountChart.update();
            
            // Update alerts
            updateFraudAlerts();
            updateRecentTransactions();
        }
        
        function updateFraudAlerts() {
            const alertsContainer = document.getElementById('fraud-alerts');
            const numAlerts = Math.floor(Math.random() * 5);
            
            if (numAlerts === 0) {
                alertsContainer.innerHTML = '<p style="text-align: center; color: #4caf50;">âœ… No fraud alerts at this time</p>';
                return;
            }
            
            let alertsHTML = '';
            for (let i = 0; i < numAlerts; i++) {
                const severity = Math.random() > 0.7 ? 'alert-high' : '';
                const amount = (Math.random() * 10000 + 100).toFixed(2);
                const userId = Math.floor(Math.random() * 9999) + 1000;
                const locations = ['New York', 'Los Angeles', 'Chicago', 'Miami', 'Las Vegas'];
                const location = locations[Math.floor(Math.random() * locations.length)];
                
                alertsHTML += `
                    <div class="alert ${severity}">
                        <strong>ðŸ”´ Fraud Alert</strong> - User ${userId}<br>
                        Amount: $${amount} | Location: ${location}<br>
                        Risk Score: ${(Math.random() * 0.4 + 0.6).toFixed(2)}
                    </div>
                `;
            }
            alertsContainer.innerHTML = alertsHTML;
        }
        
        function updateRecentTransactions() {
            const transactionsContainer = document.getElementById('recent-transactions');
            let transactionsHTML = '<table style="width: 100%; border-collapse: collapse;">';
            transactionsHTML += '<tr style="background: #f5f5f5;"><th style="padding: 8px; text-align: left;">User ID</th><th>Amount</th><th>Location</th><th>Status</th></tr>';
            
            for (let i = 0; i < 8; i++) {
                const userId = Math.floor(Math.random() * 9999) + 1000;
                const amount = (Math.random() * 5000 + 10).toFixed(2);
                const locations = ['New York', 'Los Angeles', 'Chicago', 'Miami', 'Seattle', 'Boston'];
                const location = locations[Math.floor(Math.random() * locations.length)];
                const isFraud = Math.random() < 0.1;
                const status = isFraud ? 
                    '<span class="status status-fraud">FRAUD</span>' : 
                    '<span class="status status-legit">LEGIT</span>';
                
                transactionsHTML += `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 8px;">${userId}</td>
                        <td style="padding: 8px;">$${amount}</td>
                        <td style="padding: 8px;">${location}</td>
                        <td style="padding: 8px;">${status}</td>
                    </tr>
                `;
            }
            transactionsHTML += '</table>';
            transactionsContainer.innerHTML = transactionsHTML;
        }
        
        // Load initial data
        loadDashboardData();
        
        // Refresh every 15 seconds
        setInterval(loadDashboardData, 15000);
        
        // Add a note about data source
        console.log('ðŸ“Š Fraud Detection Dashboard');
        console.log('This is a demo dashboard. In production, it would connect to:');
        console.log('- Real CSV files from Spark processing');
        console.log('- REST API endpoints');
        console.log('- WebSocket connections for real-time updates');
    </script>
</body>
</html>
